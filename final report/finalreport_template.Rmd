---
title: "Final Report: Investigating COVID-19's Impact on Food Insecurity Rates in North Carolina"
subtitle: "due November 16, 2021 by 11:59 PM "
author: "Tahmaro Ouedraogo and Elaijah Lapay"
date: "11/16/2021"
output: pdf_document
---
```{r load-packages, message = FALSE, warning = FALSE, echo = FALSE}
library(tidyverse) 
library(readxl)
library(tinytex)
library(tidymodels)
library(infer)
library(spdep)
```
```{r load-data-and-mutate, message = F, warning = FALSE, echo = FALSE}
library(readxl)
finc <- read_excel("~/R/Team-E-T/data/finc.xlsx", sheet = " County Projections")

finc_glimpse <- finc

finc <- finc %>%
  mutate(FI_Diff=`2021 FI Percent`-`FI 2019 Percent`) %>%
  mutate(FI_PC_Change= (FI_Diff/`FI 2019 Percent`)*100)

finc <- finc %>%
  mutate(`Rural-urban Continuum Code`, Urban_cat = ifelse(`Rural-urban Continuum Code`%in% c("1","2","3"), "Urban", "Rural"))

finc <- finc %>%
  mutate(Greater15pc_change_FI_Diff = if_else(`FI_PC_Change`< 10, "0", "1"))

finc <- finc %>%
  mutate(`x100 FI 2019 Percent` = `FI 2019 Percent`* 100) %>%
  mutate(`x100 2021 FI Percent` = `2021 FI Percent`* 100)

finc$Greater15pc_change_FI_Diff <- as_factor(finc$Greater15pc_change_FI_Diff)
```

# Background and Research Questions, and Data Sources

The persistent issue of food insecurity is a complex but important factor in a person’s well-being and nutrition, and is an important social determinant of health. Food security is defined by the Food and Agriculture Organization of the United Nations as lack of "regular access to enough safe and nutritious food for normal growth and development and for an active and healthy life." There are a variety of factors that have the potential to impact food security, both generally and in the context of the COVID-19 Pandemic. These questions in North Carolina, a growing and diversifying state, are all the more relevant as hunger relief organizations and public officials alike have been working to tackle the pandemic's many lasting effects in society, one of these being food insecurity. With this in mind, it is worth taking a step back to assess, based on data from a variety of sources, the degree of statistical support to emphasizing various factors' impact on food security, including temporally and during the pandemic itself.

This project's motivating research questions are the following:

Does North Carolina County level data provide evidence to support that there has been a statistically significant change to food insecurity rates from 2019 to 2021, and if there is support, what is the magnitude of this change?

To what extent are the following variables able to predict North Carolinian county-level food insecurity rates and the rate's change from 2019 to 2021: unemployment change from 2019-2021, meal price in 2019, education level, level of broadband internet, race and ethnicity, and degree of urbanization? Are some variables better predictors of rate versus rate change and vice versa?

Finally, if there is evidence to support that there has been a statistically significant change to food insecurity rates from 2019 to 2021, to what extent are categorical variables detailed above able to predict a percent change of greater than 10% in food insecurity from 2019 to 2021, signifying a greater understanding into the most impacted areas of North Carolina during the two year period?

Data directly related to food insecurity and change in employment in North Carolinian Counties in 2019 (generally referred to as "pre-COVID") and 2021 (generally referred to as "post-COVID") was sourced from Feeding America, the United States’ largest hunger relief organization, that compiles national, state, and local data on food insecurity as a part of the organization’s “Map the Meal Gap” and “Coronavirus and Food Security” Research Initiatives. Feeding America Data was sourced from here: https://www.feedingamerica.org/research/map-the-meal-gap/by-county

Data related to urbanization categories for North Carolinian counties was sourced from the USDA’s Economic Research Service and the results of the American Community Survey from 2015 to 2019. USDA Economic Research Service Data was sourced from here: https://www.ers.usda.gov/data-products/county-level-data-sets/download-data/

Data directly related to education levels and level of broadband internet at home in North Carolinian counties were sourced from My Future NC, a nonprofit intended to measure and provide policy recommendations related to educational attainments in North Carolina. My Future NC was sourced from here: https://dashboard.myfuturenc.org/county-data-and-resources/   

The results for these variables for each North Carolinian county were combined into one Excel sheet, as well as one variable where counties were manually coded for each of the three North Carolina Regions it falls into -- Coastal Plains, Piedmont, and Mountains (sourced here: https://www.ncpedia.org/geography/counties); this complete dataset was loaded into R for analysis.

# Dataset Glimpse
```{r glimpse-data, echo=FALSE}
glimpse(finc_glimpse)
```

# Exploratory Data Analysis and Investigation Methodology

In order to investigate the first research question, a plot was constructed to determine the extent to explore the numerical, as well as geographic, distribution of the Percent Change in Food Insecurity in North Carolina, as well as the distribution of the Percent Change in Child Food Insecurity in North Carolina by county, both from 2019 to 2021.

```{r early-visual-1, message = FALSE, warning = FALSE, echo = FALSE}
nc <- st_read(system.file("shapes/sids.shp", package="spData")[1], quiet=TRUE) %>%
rename(County = NAME)
nc_plot <- finc %>%
full_join(nc)

ggplot(data = nc_plot) +
  geom_sf(aes(fill= `FI_PC_Change`, color = Region, geometry = geometry)) +
  labs(title = "Food Insecurity in NC Counties: 2019 to 2021") +
scale_fill_continuous(low = "yellow", high = "red", name = "Percent Difference in Food 
Security: 2019 to 2021", label = scales::comma) + 
  theme(axis.title.x=element_blank(), axis.text.x=element_blank(), axis.ticks.x=element_blank(),
        axis.title.y=element_blank(), axis.text.y=element_blank(), axis.ticks.y=element_blank())

ggplot(data = nc_plot) +
  geom_sf(aes(fill= `x100 2021 FI Percent`, color = Region, geometry = geometry)) +
  labs(title = "Food Insecurity in NC Counties: 2019 to 2021") +
scale_fill_continuous(low = "yellow", high = "red", name = "Percent Difference in Food 
Security: 2019 to 2021", label = scales::comma) + 
  theme(axis.title.x=element_blank(), axis.text.x=element_blank(), axis.ticks.x=element_blank(),
        axis.title.y=element_blank(), axis.text.y=element_blank(), axis.ticks.y=element_blank())
```
Note: NC Map Data sourced from https://r-spatial.github.io/spdep/articles/sids.html

Being able to explore the percent change in food insecurity for the counties in and around the Charlotte and Triangle area as opposed to the more rural Eastern and Western portions of the state reveal interesting results. For example, there was a rise in food security in the urban areas surrounding Charlotte, but not in Eastern North Carolina, and there was a county that appears to have decreased in food insecurity in the pandemic. 

To investigate the differences in 2019 and 2021 Food Insecurity Percent Changes, a 1 Sample 2-Sided T-Test was run on two different variables: a paired variable that was the difference in 2021 from 2019 Food Insecurity Data per county, and a variable that calculated percent change per county from 2019 to 2021 based on the paired percent difference variable. A 95% Confidence Interval for the true percent difference and percent change in food insecurity rates for North Carolina counties will be obtained from running this test as well.

To further investigate the impact of other variables to food insecurity rates and change in food insecurity rates, two linear regression model will be fit in order to model the following: $$\hat{y}_i = \hat{\beta}_0 + \hat{\beta}_1(meal_i) + \hat{\beta}_2(urban_i) + \hat{\beta}_3({\Delta}unemp_i) + \hat{\beta}_4(<hs_i) + 
\hat{\beta}_5({=}hs) + \hat{\beta}_6(somecollege) + \hat{\beta}_7(degree)$$
$$+ \hat{\beta}_8(hhincome) + \hat{\beta}_9(region) + \hat{\beta}_{10}(internet) + \hat{\beta}_{11}(hispanic) + \hat{\beta}_{12}(white)$$
Where the response variable for one linear regression model is food insecurity rates in 2021 and the other is the change in food insecurity in North Carolinian counties from 2019 to 2021.

The residual plot and R^2 Adjusted Term will be determined for both linear regressions as well in order to confirm that there are not any irregularities with the regression that hinders the model's validity. Any concerns will warrant further investigation

Once a valid linear regression is fitted for both response variables, significant predictor variables based on p-values and confidence intervals will be isolated and intepreted in context. Those that are deemed based on the linear regression to be significant will be fitted on a new single linear regression and interaction terms among these ramining variables will be assessed to determine greater fit based upon the R^2 adjusted calculation yielded.

Regardless of statistical significance of particular variables in the above term, it is also of interest to explore

# T-test

```{r run t-tests, message = FALSE, warning = FALSE, echo = FALSE}
t.test(finc$FI_Diff, mu=0) %>%
  tidy() %>%
knitr::kable(caption= "1 Sample Paired 2-Sided T-Test Testing Null Hypothesis of a True Percent Difference from 2019 to 2021 Food Insecurity Rates for NC Counties  = 0")

t.test(finc$FI_PC_Change, mu=0) %>%
  tidy() %>%
knitr::kable(caption= "1 Sample 2-Sided T-Test Testing Null Hypothesis of a True Percent Change from 2019 to 2021 Food Insecurity Rates for NC Counties, Calculated from Feeding America  = 0")
```

# Linear Regression Investigation- 2021

```{r run_regression_0, message = FALSE, warning = FALSE, echo = FALSE}

finc$Region=as.factor(finc$Region)

finc$Region=relevel(finc$Region, ref = "Piedmont")

finc_linear_1 <- linear_reg() %>%
  set_engine("lm") %>%
  fit(`FI_PC_Change` ~ `2019 Cost per Meal` + `Urban_cat` + `Unemployment Change` + `Percent Less than HS` + `HS or GED` + `Some College, No Degree` + `Household Income` + `Region` + `Percent Broadband Internet at Home` + `Hispanic` + `Percent non-Hispanic White`, data = finc)

finc_linear_1 %>% tidy(conf.int=TRUE) %>% knitr::kable(caption="R-Squared-Adjusted Value for Main Linear Regression of Food Insecurity Change in North Carolina, 2019-2021")

glance(finc_linear_1)$adj.r.squared %>% tidy() %>% knitr::kable(caption="R-Squared-Adjusted Value for Main Linear Regression of Food Insecurity Change in North Carolina, 2019-2021")

finc_linear_1_aug <- augment(finc_linear_1$fit)
ggplot(finc_linear_1_aug, mapping = aes(x = .fitted, y = .resid)) +
  geom_point(alpha = 0.5) +
  geom_hline(yintercept = 0, color = "gray", lty = "dashed") +
  labs(x = "2019 to 2021 Food Inscurity Percent Change by NC County", 
       y = "Residuals", 
       title = "Residuals of Linear Regression for 2019 to 2021 
Food Inscurity Percent Change by NC County")


finc_linear_2 <- linear_reg() %>%
  set_engine("lm") %>%
  fit(`2021 FI Percent` ~ `2019 Cost per Meal` + `Urban_cat` + `Unemployment Change` + `Percent Less than HS` + `HS or GED` + `Some College, No Degree` + `Household Income` + `Region` + `Percent Broadband Internet at Home` + `Hispanic` + `Percent non-Hispanic White`, data = finc)

finc_linear_2 %>% tidy(conf.int=TRUE) %>% knitr::kable(caption="R-Squared-Adjusted Value for Main Linear Regression of Food Insecurity Rates in North Carolina, 2021")

glance(finc_linear_2)$adj.r.squared %>% tidy() %>% knitr::kable(caption="R-Squared-Adjusted Value for Main Linear Regression of Food Insecurity Rates in North Carolina, 2021")

finc_linear_2_aug <- augment(finc_linear_2$fit)
ggplot(finc_linear_2_aug, mapping = aes(x = .fitted, y = .resid)) +
  geom_point(alpha = 0.5) +
  geom_hline(yintercept = 0, color = "gray", lty = "dashed") +
  labs(x = "2019 to 2021 Food Inscurity Percent Change by NC County", 
       y = "Residuals", 
       title = "Residuals of Linear Regression for 2019 to 2021 
Food Inscurity Percent Change by NC County")
```

# Logistic Regression

```{r log_plot, message = FALSE, warning = FALSE, echo = FALSE}

ggplot(finc, aes(x = Urban_cat, 
                  fill = Greater15pc_change_FI_Diff)) +
  geom_bar(position = "fill") +
  labs (
    x = "NC Urban/Rural County Status",
    y = "Proportion",
    fill = "Experienced
Greater than
10% Increase
In Food Insecurity
During Pandemic",
    title = "NC Counties by Greater than 10% Food Security Increase 
In Pandemic and Rural/Urban Status",
)

ggplot(finc, aes(x = `x100 FI 2019 Percent`, y = `x100 2021 FI Percent`, color = Urban_cat)) +
  geom_point() +
  labs(
    title = "Food Insecurity by North Carolina County: 2019 to 2021",
    x = "Percent of Residents Facing Food Insecurity, 2019",
    y = "Percent of Residents Facing Food Insecurity, 2021"
  )
```

```{r run_log_regression_1, message = FALSE, warning = FALSE, echo = FALSE}

fs_percentchange_1_fit <- logistic_reg() %>%
  set_engine("glm") %>%
  fit(Greater15pc_change_FI_Diff ~ Urban_cat, data = finc, family = "binomial")
tidy(fs_percentchange_1_fit,conf.int=TRUE) %>%
  mutate(
    odds = exp(estimate),
    conf.low.exp = exp(conf.low),
    conf.high.exp = exp(conf.high)
  ) %>% 
  select(term, odds, p.value, conf.low.exp, conf.high.exp) %>%
knitr::kable(caption="Results of Logistic Regression Table Determining Odds 
of Food Security Change During Pandemic Greater than 10% by Urban-Rural Status")
```

